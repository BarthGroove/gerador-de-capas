<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Capas para YouTube</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Bangers&family=Inter:wght@400;700&family=Oswald&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            background: #8b5cf6; cursor: pointer; border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px; background: #8b5cf6; cursor: pointer; border-radius: 50%;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #8b5cf6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #notification {
            transition: opacity 0.3s ease-in-out, bottom 0.3s ease-in-out;
        }
        #pexels-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
        }
        #pexels-results img {
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s;
        }
        #pexels-results img:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.7);
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col md:flex-row h-screen overflow-hidden">

    <!-- Painel de Controles (Esquerda) -->
    <div class="w-full md:w-1/3 lg:w-1/4 bg-gray-800 p-6 overflow-y-auto space-y-6">
        <h1 class="text-2xl font-bold text-center text-violet-400">Gerador de Capas</h1>
        
        <!-- Busca de Imagens Pexels -->
        <div class="space-y-4 rounded-lg bg-gray-700 p-4">
            <h3 class="font-bold">Buscar Imagem de Fundo (Pexels)</h3>
            <div>
                <label for="pexelsApiKey" class="block text-sm font-medium">Sua Chave da API (Pexels)</label>
                <input type="password" id="pexelsApiKey" placeholder="Cole sua chave da API do Pexels" class="mt-1 w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-violet-500">
            </div>
            <div class="flex space-x-2">
                <input type="text" id="pexelsSearchQuery" placeholder="Ex: tecnologia, natureza..." class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-violet-500">
                <button id="pexelsSearchBtn" class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-2 px-4 rounded-lg">Buscar</button>
            </div>
            <div id="pexels-results" class="max-h-48 overflow-y-auto rounded-md bg-gray-800 p-2"></div>
        </div>

        <!-- Controle de Imagens (Upload Manual) -->
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Ou envie do seu computador:</label>
                <input type="file" id="imageLoader" accept="image/*" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100 cursor-pointer" title="Carregar Imagem de Fundo">
            </div>
            <div>
                <input type="file" id="foregroundImageLoader" accept="image/*" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100 cursor-pointer" title="Carregar Imagem Destacada">
            </div>
        </div>

        <!-- Filtros da Imagem de Fundo -->
        <div class="space-y-4 rounded-lg bg-gray-700 p-4">
            <h2 class="font-bold">Filtros da Imagem de Fundo</h2>
            <label for="brightness" class="block text-sm font-medium">Brilho: <span id="brightnessValue">100</span>%</label>
            <input type="range" id="brightness" min="0" max="200" value="100" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
            <label for="contrast" class="block text-sm font-medium">Contraste: <span id="contrastValue">100</span>%</label>
            <input type="range" id="contrast" min="0" max="200" value="100" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
            <label for="saturate" class="block text-sm font-medium">Saturação: <span id="saturateValue">100</span>%</label>
            <input type="range" id="saturate" min="0" max="200" value="100" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
        </div>
        
        <!-- Controles da Imagem Destacada -->
        <div class="space-y-4 rounded-lg bg-gray-700 p-4">
            <h2 class="font-bold">Controles da Imagem Destacada</h2>
            <label for="fgScale" class="block text-sm font-medium">Tamanho: <span id="fgScaleValue">100</span>%</label>
            <input type="range" id="fgScale" min="10" max="300" value="100" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
            <label for="fgX" class="block text-sm font-medium">Posição Horizontal: <span id="fgXValue">640</span></label>
            <input type="range" id="fgX" min="0" max="1280" value="640" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
            <label for="fgY" class="block text-sm font-medium">Posição Vertical: <span id="fgYValue">360</span></label>
            <input type="range" id="fgY" min="0" max="720" value="360" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
        </div>

        <!-- Controles de Texto Principal -->
        <div class="space-y-4 rounded-lg bg-gray-700 p-4">
            <h2 class="font-bold">Texto Principal</h2>
            <input type="text" id="mainText" placeholder="Digite o texto principal..." class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-violet-500">
            <label for="mainFont" class="block text-sm font-medium">Fonte</label>
            <select id="mainFont" class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-violet-500">
                <option value="Anton" selected>Anton</option>
                <option value="Bangers">Bangers</option>
                <option value="Press Start 2P">Press Start 2P</option>
                <option value="Oswald">Oswald</option>
                <option value="Inter">Inter</option>
            </select>
            <label for="mainTextColor" class="block text-sm font-medium">Cor</label>
            <input type="color" id="mainTextColor" value="#FFFFFF" class="w-full h-10 p-1 bg-gray-800 border border-gray-600 rounded-md cursor-pointer">
            <label for="mainTextSize" class="block text-sm font-medium">Tamanho: <span id="mainTextSizeValue">120</span>px</label>
            <input type="range" id="mainTextSize" min="20" max="300" value="120" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
            <label for="mainTextX" class="block text-sm font-medium">Posição Horizontal: <span id="mainTextXValue">640</span></label>
            <input type="range" id="mainTextX" min="0" max="1280" value="640" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
            <label for="mainTextY" class="block text-sm font-medium">Posição Vertical: <span id="mainTextYValue">150</span></label>
            <input type="range" id="mainTextY" min="0" max="720" value="150" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
        </div>

        <!-- Controles de Texto Secundário -->
        <div class="space-y-4 rounded-lg bg-gray-700 p-4">
            <h2 class="font-bold">Texto Secundário</h2>
             <input type="text" id="subText" placeholder="Digite o texto secundário..." class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-violet-500">
             <label for="subFont" class="block text-sm font-medium">Fonte</label>
            <select id="subFont" class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-violet-500">
                <option value="Anton">Anton</option>
                <option value="Bangers">Bangers</option>
                <option value="Press Start 2P">Press Start 2P</option>
                <option value="Oswald">Oswald</option>
                <option value="Inter" selected>Inter</option>
            </select>
            <label for="subTextColor" class="block text-sm font-medium">Cor</label>
            <input type="color" id="subTextColor" value="#FFFF00" class="w-full h-10 p-1 bg-gray-800 border border-gray-600 rounded-md cursor-pointer">
            <label for="subTextSize" class="block text-sm font-medium">Tamanho: <span id="subTextSizeValue">70</span>px</label>
            <input type="range" id="subTextSize" min="20" max="200" value="70" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
            <label for="subTextX" class="block text-sm font-medium">Posição Horizontal: <span id="subTextXValue">640</span></label>
            <input type="range" id="subTextX" min="0" max="1280" value="640" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
            <label for="subTextY" class="block text-sm font-medium">Posição Vertical: <span id="subTextYValue">600</span></label>
            <input type="range" id="subTextY" min="0" max="720" value="600" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
        </div>

        <button id="downloadBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300">
            Baixar Capa (PNG)
        </button>
    </div>

    <!-- Área de Visualização (Direita) -->
    <div id="canvasContainer" class="w-full md:w-2/3 lg:w-3/4 bg-gray-900 flex items-center justify-center p-4 md:p-8 relative">
        <canvas id="thumbnailCanvas" width="1280" height="720" class="bg-gray-700 rounded-lg shadow-2xl max-w-full h-auto"></canvas>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="hidden fixed -bottom-20 right-5 bg-green-500 text-white py-3 px-5 rounded-lg shadow-lg">
        <p>Mensagem de notificação</p>
    </div>

    <script>
        // --- SELEÇÃO DOS ELEMENTOS DO DOM ---
        const canvas = document.getElementById('thumbnailCanvas');
        const ctx = canvas.getContext('2d');
        const imageLoader = document.getElementById('imageLoader');
        const foregroundImageLoader = document.getElementById('foregroundImageLoader');
        const downloadBtn = document.getElementById('downloadBtn');
        const notification = document.getElementById('notification');
        const pexelsApiKey = document.getElementById('pexelsApiKey');
        const pexelsSearchQuery = document.getElementById('pexelsSearchQuery');
        const pexelsSearchBtn = document.getElementById('pexelsSearchBtn');
        const pexelsResults = document.getElementById('pexels-results');
        
        // Controles de Filtros
        const brightness = document.getElementById('brightness');
        const contrast = document.getElementById('contrast');
        const saturate = document.getElementById('saturate');
        const brightnessValue = document.getElementById('brightnessValue');
        const contrastValue = document.getElementById('contrastValue');
        const saturateValue = document.getElementById('saturateValue');

        // Controles da Imagem Destacada
        const fgScale = document.getElementById('fgScale');
        const fgX = document.getElementById('fgX');
        const fgY = document.getElementById('fgY');
        const fgScaleValue = document.getElementById('fgScaleValue');
        const fgXValue = document.getElementById('fgXValue');
        const fgYValue = document.getElementById('fgYValue');

        // Controles do Texto Principal
        const mainText = document.getElementById('mainText');
        const mainFont = document.getElementById('mainFont');
        const mainTextColor = document.getElementById('mainTextColor');
        const mainTextSize = document.getElementById('mainTextSize');
        const mainTextX = document.getElementById('mainTextX');
        const mainTextY = document.getElementById('mainTextY');
        const mainTextSizeValue = document.getElementById('mainTextSizeValue');
        const mainTextXValue = document.getElementById('mainTextXValue');
        const mainTextYValue = document.getElementById('mainTextYValue');
        
        // Controles do Texto Secundário
        const subText = document.getElementById('subText');
        const subFont = document.getElementById('subFont');
        const subTextColor = document.getElementById('subTextColor');
        const subTextSize = document.getElementById('subTextSize');
        const subTextX = document.getElementById('subTextX');
        const subTextY = document.getElementById('subTextY');
        const subTextSizeValue = document.getElementById('subTextSizeValue');
        const subTextXValue = document.getElementById('subTextXValue');
        const subTextYValue = document.getElementById('subTextYValue');

        // --- ESTADO INICIAL ---
        let backgroundImage = null;
        let foregroundImage = null;

        const filterState = { brightness: 100, contrast: 100, saturate: 100 };
        const foregroundImageState = { x: 640, y: 360, scale: 1.0 };
        const textState = {
            main: { text: 'TÍTULO INCRÍVEL', color: '#FFFFFF', size: 120, y: 150, x: 640, font: 'Anton' },
            sub: { text: 'Texto de apoio aqui', color: '#FFFF00', size: 70, y: 600, x: 640, font: 'Inter' }
        };
        
        // --- FUNÇÕES DO SISTEMA ---
        function showNotification(message, isError = false) {
            const p = notification.querySelector('p');
            p.textContent = message;
            notification.classList.remove('bg-green-500', 'bg-red-500', 'hidden', '-bottom-20');
            notification.classList.add(isError ? 'bg-red-500' : 'bg-green-500');
            setTimeout(() => { notification.classList.add('bottom-5'); }, 10);
            setTimeout(() => {
                notification.classList.remove('bottom-5');
                notification.classList.add('-bottom-20');
            }, isError ? 10000 : 4000);
        }

        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Aplica os filtros antes de desenhar a imagem de fundo
            ctx.filter = `brightness(${filterState.brightness}%) contrast(${filterState.contrast}%) saturate(${filterState.saturate}%)`;

            if (!backgroundImage) {
                ctx.fillStyle = '#374151';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#9ca3af';
                ctx.textAlign = 'center';
                ctx.font = "40px Inter";
                ctx.fillText('Use a busca ou envie uma imagem', canvas.width / 2, canvas.height / 2);
            } else {
                ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
            }

            // Reseta os filtros para não afetar os outros elementos
            ctx.filter = 'none';

            if (foregroundImage) {
                const scale = foregroundImageState.scale;
                const w = foregroundImage.width * scale;
                const h = foregroundImage.height * scale;
                const x = foregroundImageState.x - w / 2;
                const y = foregroundImageState.y - h / 2;
                ctx.drawImage(foregroundImage, x, y, w, h);
            }
            drawText(textState.main);
            drawText(textState.sub);
        }
        
        function drawText(state) {
            ctx.font = `bold ${state.size}px "${state.font}"`;
            ctx.fillStyle = state.color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = state.size / 15;
            ctx.strokeText(state.text, state.x, state.y);
            ctx.fillText(state.text, state.x, state.y);
        }

        function handleImageLoad(file, imageType) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                const img = new Image();
                img.onload = () => {
                    if (imageType === 'background') backgroundImage = img;
                    else if (imageType === 'foreground') foregroundImage = img;
                    redrawCanvas();
                };
                img.src = reader.result;
            };
            reader.readAsDataURL(file);
        }

        // --- LÓGICA DO PEXELS ---
        async function searchPexels() {
            const apiKey = pexelsApiKey.value;
            const query = pexelsSearchQuery.value;
            if (!apiKey) {
                showNotification('Por favor, insira sua chave da API do Pexels.', true);
                return;
            }
            if (!query) {
                showNotification('Por favor, digite um termo para a busca.', true);
                return;
            }
            pexelsResults.innerHTML = '<div class="col-span-full flex justify-center"><div class="loader"></div></div>';
            const url = `https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=15&page=1`;
            try {
                const response = await fetch(url, { headers: { 'Authorization': apiKey } });
                if (!response.ok) { throw new Error(`Erro na busca: ${response.statusText} (${response.status})`); }
                const data = await response.json();
                displayPexelsResults(data.photos);
            } catch (error) {
                console.error("Erro ao buscar no Pexels:", error);
                showNotification(`Falha na busca. Detalhes: ${error.message}`, true);
                pexelsResults.innerHTML = '<p class="text-center text-red-400">A busca falhou.</p>';
            }
        }

        function displayPexelsResults(photos) {
            pexelsResults.innerHTML = '';
            if (photos.length === 0) {
                pexelsResults.innerHTML = '<p class="text-center text-gray-400">Nenhum resultado encontrado.</p>';
                return;
            }
            photos.forEach(photo => {
                const imgElement = document.createElement('img');
                imgElement.src = photo.src.tiny;
                imgElement.alt = photo.alt;
                imgElement.className = 'rounded-md w-full h-full object-cover';
                imgElement.onclick = () => setBackgroundFromPexels(photo.src.large2x);
                pexelsResults.appendChild(imgElement);
            });
        }

        function setBackgroundFromPexels(imageUrl) {
            showNotification('Carregando imagem de alta resolução...');
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = () => {
                backgroundImage = img;
                redrawCanvas();
                showNotification('Imagem de fundo atualizada!', false);
            };
            img.onerror = () => showNotification('Não foi possível carregar a imagem selecionada.', true);
            img.src = imageUrl;
        }

        // --- EVENT LISTENERS ---
        imageLoader.addEventListener('change', (e) => handleImageLoad(e.target.files[0], 'background'));
        foregroundImageLoader.addEventListener('change', (e) => handleImageLoad(e.target.files[0], 'foreground'));
        pexelsSearchBtn.addEventListener('click', searchPexels);
        pexelsSearchQuery.addEventListener('keyup', (e) => { if (e.key === 'Enter') searchPexels(); });

        // Listeners para Filtros
        brightness.addEventListener('input', (e) => {
            filterState.brightness = e.target.value;
            brightnessValue.textContent = e.target.value;
            redrawCanvas();
        });
        contrast.addEventListener('input', (e) => {
            filterState.contrast = e.target.value;
            contrastValue.textContent = e.target.value;
            redrawCanvas();
        });
        saturate.addEventListener('input', (e) => {
            filterState.saturate = e.target.value;
            saturateValue.textContent = e.target.value;
            redrawCanvas();
        });

        // Listeners para Imagem Destacada
        fgScale.addEventListener('input', (e) => {
            foregroundImageState.scale = parseFloat(e.target.value) / 100;
            fgScaleValue.textContent = e.target.value;
            redrawCanvas();
        });
        fgX.addEventListener('input', (e) => {
            foregroundImageState.x = parseInt(e.target.value);
            fgXValue.textContent = e.target.value;
            redrawCanvas();
        });
        fgY.addEventListener('input', (e) => {
            foregroundImageState.y = parseInt(e.target.value);
            fgYValue.textContent = e.target.value;
            redrawCanvas();
        });

        // Listeners para os Textos
        function setupTextListeners(type) {
            const textInput = document.getElementById(`${type}Text`);
            const fontInput = document.getElementById(`${type}Font`);
            const colorInput = document.getElementById(`${type}TextColor`);
            const sizeInput = document.getElementById(`${type}TextSize`);
            const xInput = document.getElementById(`${type}TextX`);
            const yInput = document.getElementById(`${type}TextY`);
            const sizeValueSpan = document.getElementById(`${type}TextSizeValue`);
            const xValueSpan = document.getElementById(`${type}TextXValue`);
            const yValueSpan = document.getElementById(`${type}TextYValue`);

            textInput.addEventListener('input', (e) => { textState[type].text = e.target.value.toUpperCase(); redrawCanvas(); });
            fontInput.addEventListener('change', (e) => { textState[type].font = e.target.value; redrawCanvas(); });
            colorInput.addEventListener('input', (e) => { textState[type].color = e.target.value; redrawCanvas(); });
            sizeInput.addEventListener('input', (e) => { textState[type].size = parseInt(e.target.value); sizeValueSpan.textContent = e.target.value; redrawCanvas(); });
            xInput.addEventListener('input', (e) => { textState[type].x = parseInt(e.target.value); xValueSpan.textContent = e.target.value; redrawCanvas(); });
            yInput.addEventListener('input', (e) => { textState[type].y = parseInt(e.target.value); yValueSpan.textContent = e.target.value; redrawCanvas(); });
        }
        
        setupTextListeners('main');
        setupTextListeners('sub');

        downloadBtn.addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'minha-capa-de-video.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        // --- INICIALIZAÇÃO ---
        mainText.value = textState.main.text;
        subText.value = textState.sub.text;
        redrawCanvas();
    </script>
</body>
</html>
